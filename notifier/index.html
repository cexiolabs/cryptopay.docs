



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://cexiolabs.github.io/cryptopay.docs/notifier/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.jpg">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Notifier - CryptoPay Service API</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="darkblue" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#notifier" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://cexiolabs.github.io/cryptopay.docs" title="CryptoPay Service API" class="md-header-nav__button md-logo">
          
            <img src="../images/logo.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              CryptoPay Service API
            </span>
            <span class="md-header-nav__topic">
              
                Notifier
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://cexiolabs.github.io/cryptopay.docs" title="CryptoPay Service API" class="md-nav__button md-logo">
      
        <img src="../images/logo.jpg" width="48" height="48">
      
    </a>
    CryptoPay Service API
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../terminology/" title="Terminology" class="md-nav__link">
      Terminology
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="REST API" class="md-nav__link">
      REST API
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Callbacks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Callbacks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Notifier
      </label>
    
    <a href="./" title="Notifier" class="md-nav__link md-nav__link--active">
      Notifier
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use-cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delivery" class="md-nav__link">
    Delivery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-message-format" class="md-nav__link">
    Selecting message format
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-rpc" class="md-nav__link">
    JSON-RPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protocol-buffers-version-2" class="md-nav__link">
    Protocol Buffers Version 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-security" class="md-nav__link">
    Message security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signing-message" class="md-nav__link">
    Signing message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encrypt-message-optional" class="md-nav__link">
    Encrypt message (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webhooks" class="md-nav__link">
    Webhooks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" class="md-nav__link">
    Headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-verification" class="md-nav__link">
    SSL verification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-token" class="md-nav__link">
    Secret token
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    Use-cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delivery" class="md-nav__link">
    Delivery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-message-format" class="md-nav__link">
    Selecting message format
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-rpc" class="md-nav__link">
    JSON-RPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protocol-buffers-version-2" class="md-nav__link">
    Protocol Buffers Version 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-security" class="md-nav__link">
    Message security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signing-message" class="md-nav__link">
    Signing message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encrypt-message-optional" class="md-nav__link">
    Encrypt message (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webhooks" class="md-nav__link">
    Webhooks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" class="md-nav__link">
    Headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-verification" class="md-nav__link">
    SSL verification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-token" class="md-nav__link">
    Secret token
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="notifier">Notifier</h1>
<p><code>Notifier</code> is a Notification Server that implements <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publishâ€“Subscribe</a> Pattern. Main responsibility is to deliver callback messages via Webhooks and other messaging providers.</p>
<div class="admonition note">
<p class="admonition-title">Recommendation</p>
<p>Although notification includes real and valid data, we recommend to use notifications just as notifications and retvieve data via appropriate method of Pull API (<a href="../api">REST API</a> for example).
In general, any notifications system by design may delay messages. Good practice for end-application is to check status via Pull API if expected message was not received in expected time frame.</p>
</div>
<h2 id="general-information">General information</h2>
<h3 id="use-cases">Use-cases</h3>
<div class="mermaid">sequenceDiagram
    participant Subscriber1
    participant Subscriber2
    participant `Notifier`
    participant Publisher
    opt Event A happend
        Publisher-&gt;&gt;`Notifier`: Message A for "my" topic
        `Notifier`-&gt;&gt;`Notifier`: Skip, just audit
    end
    Subscriber2-&gt;&gt;+`Notifier`: Subscribe "my" topic
    `Notifier`--&gt;&gt;-Subscriber2: OK
    opt Event B happend
        Publisher-&gt;&gt;`Notifier`: Message B for "my" topic
        `Notifier`-&gt;&gt;+Subscriber2: Message B for "my" topic
        Subscriber2--&gt;&gt;-`Notifier`: OK
    end
    Subscriber1-&gt;&gt;+`Notifier`: Subscribe "my" topic
    `Notifier`--&gt;&gt;-Subscriber1: OK
    opt Event C happend
        Publisher-&gt;&gt;`Notifier`: Message C for "my" topic
        `Notifier`-&gt;&gt;+Subscriber2: Message C for "my" topic
        Subscriber2--&gt;&gt;-`Notifier`: OK
        `Notifier`-&gt;&gt;+Subscriber1: Message C for "my" topic
        Subscriber1--&gt;&gt;-`Notifier`: OK
    end
    Subscriber1-&gt;&gt;+`Notifier`: UNsubscribe "my" topic
    `Notifier`--&gt;&gt;-Subscriber1: OK
    opt Event D happend
        Publisher-&gt;&gt;`Notifier`: Message D for "my" topic
        `Notifier`-&gt;&gt;+Subscriber2: Message D for "my" topic
        Subscriber2--&gt;&gt;-`Notifier`: OK
    end</div>

<h3 id="delivery">Delivery</h3>
<p>Messages are sent immediately after an operation was performed.</p>
<p><code>Notifier</code> records the fact of message delivery to your system after receiving the response from your system.</p>
<p>If message delivery is failed the server will retry with delay between attempts according to a scale was choosen at subscription phase.</p>
<p>For example powers of two scale will retry delivery until the period does not exceed 16384 seconds (~4.5hours): 1, 2, 4, 8, 16, ..., 16384(max).</p>
<p>Notification server performs attempts to deliver a message within 3 days.</p>
<h3 id="selecting-message-format">Selecting message format</h3>
<p>Along with setup your notification endpoint, you may choose message format.</p>
<h4 id="json-rpc"><a href="https://www.jsonrpc.org/specification">JSON-RPC</a></h4>
<p>Using JSON-RPC in notification manner
<div class="codehilite"><pre><span></span><span class="err">--&gt;</span> <span class="p">{</span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;somethingChanged&quot;</span><span class="p">,</span> <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;68ac6741f92d41fbbc894ab406fcc91d&quot;</span><span class="p">,</span> <span class="err">......</span> <span class="p">}}</span>
<span class="err">--&gt;</span> <span class="p">{</span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;somethingAdded&quot;</span><span class="p">,</span> <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;3d80cbbe&quot;</span><span class="p">,</span> <span class="err">......</span> <span class="p">}}</span>
</pre></div></p>
<h4 id="protocol-buffers-version-2"><a href="https://developers.google.com/protocol-buffers/docs/reference/proto2-spec">Protocol Buffers Version 2</a></h4>
<p>Using Protocol Buffers for message serialization. See definition .proto file for details.</p>
<h3 id="message-security">Message security</h3>
<p><code>Notifier</code> provides Signing and Encrypt methods to verify that the request is legitimate.</p>
<h4 id="signing-message">Signing message</h4>
<p>The signature is generated by creating a sha256 HMAC using the base64-decoded secret key on the prehash binary data <strong>timestamp</strong> + <strong>message</strong> (where + represents concatenation) and base64-encode the output. The timestamp value pass along with callback request. See details for concrete callback endpoint below.</p>
<blockquote>
<blockquote>
<blockquote>
<p><strong>Note:</strong> Do not forget to base64-decode the alphanumeric secret string (resulting in 64 bytes) before using it as the key for HMAC.
</p>
</blockquote>
</blockquote>
</blockquote>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Bash + OpenSSL</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="nv">RECEIVED_SIGNATURE</span><span class="o">=</span><span class="s2">&quot;ZPRij68bsUH6C/TJ/2fg5iZt88Cc2onqdU2RfubwUVA=&quot;</span>
<span class="nv">RECEIVED_TIMESTAMP</span><span class="o">=</span><span class="m">1573753848</span>
<span class="nv">RECEIVED_MESSAGE</span><span class="o">=</span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;somethingChanged&quot;,&quot;params&quot;:{&quot;id&quot;:&quot;1490548887804-XA-1112-TU&quot;}}&#39;</span>

<span class="nv">WHAT</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RECEIVED_TIMESTAMP</span><span class="si">}${</span><span class="nv">RECEIVED_MESSAGE</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nv">NOTIFICATION_SECRET</span><span class="o">=</span><span class="s2">&quot;qf8qDqcEYcFQre2mgdshfdWDs29ObeW708grqMtW9I1rLY9iAl3EUn6A1HoeMSSp3XNL3qUlRJRrlo4eo7JxBw==&quot;</span>
<span class="nv">SECRET_KEY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">NOTIFICATION_SECRET</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">|</span> base64 --decode <span class="p">|</span> hexdump -v -e <span class="s1">&#39;/1 &quot;%02x&quot;&#39;</span><span class="k">)</span>

<span class="nv">CALCULATED_SIGNATURE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">WHAT</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">|</span> openssl dgst -sha256 -mac HMAC -macopt <span class="s2">&quot;hexkey:</span><span class="nv">$SECRET_KEY</span><span class="s2">&quot;</span> <span class="p">|</span> xxd -r -p <span class="p">|</span> base64<span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CALCULATED_SIGNATURE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">RECEIVED_SIGNATURE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Received legitimate message&quot;</span>
<span class="k">fi</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">NodeJS</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">receivedSignature</span> <span class="o">=</span> <span class="s2">&quot;ZPRij68bsUH6C/TJ/2fg5iZt88Cc2onqdU2RfubwUVA=&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">receivedTimestamp</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s2">&quot;1573753848&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">receivedMessage</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;somethingChanged&quot;,&quot;params&quot;:{&quot;id&quot;:&quot;1490548887804-XA-1112-TU&quot;}}&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">what</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="nx">receivedTimestamp</span><span class="p">,</span> <span class="nx">receivedMessage</span><span class="p">]);</span>

<span class="kr">const</span> <span class="nx">notificationSecret</span> <span class="o">=</span> <span class="s2">&quot;qf8qDqcEYcFQre2mgdshfdWDs29ObeW708grqMtW9I1rLY9iAl3EUn6A1HoeMSSp3XNL3qUlRJRrlo4eo7JxBw==&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">secretKey</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">notificationSecret</span><span class="p">,</span> <span class="s2">&quot;base64&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;crypto&quot;</span><span class="p">).</span><span class="nx">createHmac</span><span class="p">(</span><span class="s2">&quot;sha256&quot;</span><span class="p">,</span> <span class="nx">secretKey</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">calculatedSignature</span> <span class="o">=</span> <span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">what</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&quot;base64&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">calculatedSignature</span> <span class="o">===</span> <span class="nx">receivedSignature</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received legitimate message&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_2" />
<label for="__tab_1_2">PHP</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$receivedSignature</span> <span class="o">=</span> <span class="s2">&quot;ZPRij68bsUH6C/TJ/2fg5iZt88Cc2onqdU2RfubwUVA=&quot;</span><span class="p">;</span>
<span class="nv">$receivedTimestamp</span> <span class="o">=</span> <span class="s2">&quot;1573753848&quot;</span><span class="p">;</span>
<span class="nv">$receivedMessage</span> <span class="o">=</span> <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;somethingChanged&quot;,&quot;params&quot;:{&quot;id&quot;:&quot;1490548887804-XA-1112-TU&quot;}}&#39;</span><span class="p">;</span>

<span class="nv">$what</span> <span class="o">=</span> <span class="nv">$receivedTimestamp</span> <span class="o">.</span> <span class="nv">$receivedMessage</span><span class="p">;</span>

<span class="nv">$notificationSecret</span> <span class="o">=</span> <span class="s2">&quot;qf8qDqcEYcFQre2mgdshfdWDs29ObeW708grqMtW9I1rLY9iAl3EUn6A1HoeMSSp3XNL3qUlRJRrlo4eo7JxBw==&quot;</span><span class="p">;</span>
<span class="nv">$secretKey</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$notificationSecret</span><span class="p">);</span>

<span class="nv">$calculatedSignature</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">&quot;sha256&quot;</span><span class="p">,</span> <span class="nv">$what</span><span class="p">,</span> <span class="nv">$secretKey</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$calculatedSignature</span> <span class="o">==</span> <span class="nv">$receivedSignature</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Received legitimate message&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>
</div>
<h4 id="encrypt-message-optional">Encrypt message (Optional)</h4>
<p>Optionally (along with signing), you may setup(via Management API) an <code>encrypt password</code>, messages will be encrypted.</p>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">Bash + OpenSSL</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>TBD
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_1" />
<label for="__tab_2_1">NodeJS</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="nx">TBD</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_2" />
<label for="__tab_2_2">PHP</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="x">TBD</span>
</pre></div></div>
</div>
<h2 id="webhooks">Webhooks</h2>
<p><a href="https://en.wikipedia.org/wiki/Webhook">Webhooks</a> are "user-defined HTTP
callbacks".
When an event occurs, <code>Notifier</code> makes an HTTP request to the URI configured for the webhook.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your endpoint should ALWAYS return a valid HTTP response with HTTP status 2XX. If you do not do this then Notifier will think the hook failed and <a href="#delivery">retry</a> it.</p>
</div>
<h3 id="headers">Headers</h3>
<p>Notification server will include following headers to each request:</p>
<ul>
<li><strong>NF-TIMESTAMP</strong> - A timestamp that was used in <a href="#signing-message">signature</a> calculation</li>
<li><strong>NF-SIGN</strong> - The base64-encoded <a href="#signing-message">signature</a></li>
</ul>
<h3 id="security">Security</h3>
<h4 id="ssl-verification">SSL verification</h4>
<p>SSL Verification enables automatically for URL scheme <code>https:</code>. No additional configuration required.</p>
<div class="admonition note">
<p class="admonition-title">Optional</p>
<p>If you specify a CA Certificates (via Merchant Management API), it will be used to verify the SSL certificate of the webhook endpoint. Otherwise the SSL certificate of the webhook endpoint is verified based on an internal list of Certificate Authorities.</p>
</div>
<h4 id="secret-token">Secret token</h4>
<p>If you setup a <code>secret token</code> (via Merchant Management API), it will be sent with the hook request in the <strong>NF-TOKEN</strong> HTTP header.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../api/" title="REST API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                REST API
              </span>
            </div>
          </a>
        
        
          <a href="../events/" title="Events" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Events
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../js/mermaid.min.js"></script>
      
    
  </body>
</html>